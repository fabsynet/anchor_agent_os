---
phase: 03-tasks-renewals-and-dashboard
plan: 05
type: execute
wave: 3
depends_on: ["03-03"]
files_modified:
  - apps/web/src/app/(dashboard)/page.tsx
  - apps/web/src/components/dashboard/summary-cards.tsx
  - apps/web/src/components/dashboard/quick-actions.tsx
  - apps/web/src/components/dashboard/renewals-widget.tsx
  - apps/web/src/components/dashboard/overdue-widget.tsx
  - apps/web/src/components/dashboard/activity-feed.tsx
  - apps/web/src/components/dashboard/premium-income.tsx
  - apps/web/src/app/(dashboard)/expenses/page.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard shows 4 summary cards: Overdue Tasks (red if >0), Due Today, Renewals in 30 Days, Active Clients"
    - "Dashboard shows quick action buttons: Add Client, Add Task, Add Policy, Add Expense"
    - "Dashboard shows upcoming renewals table with policy, client, expiry date, days remaining"
    - "Dashboard shows overdue tasks list with title, client, due date, priority"
    - "Dashboard shows recent activity feed"
    - "Dashboard shows premium income: current month, YTD, trend percentage"
    - "Add Expense button navigates to /expenses (placeholder page for Phase 5)"
  artifacts:
    - path: "apps/web/src/app/(dashboard)/page.tsx"
      provides: "Today Dashboard page replacing skeleton placeholder"
      min_lines: 40
    - path: "apps/web/src/components/dashboard/summary-cards.tsx"
      provides: "4 stat cards with counts and conditional red styling"
    - path: "apps/web/src/components/dashboard/quick-actions.tsx"
      provides: "Action buttons bar for Add Client, Task, Policy, Expense"
    - path: "apps/web/src/components/dashboard/renewals-widget.tsx"
      provides: "Upcoming renewals table with days remaining"
    - path: "apps/web/src/components/dashboard/overdue-widget.tsx"
      provides: "Overdue tasks list with priority badges"
    - path: "apps/web/src/components/dashboard/activity-feed.tsx"
      provides: "Recent activity feed with event descriptions"
    - path: "apps/web/src/components/dashboard/premium-income.tsx"
      provides: "Premium income section with current month, YTD, and trend indicator"
    - path: "apps/web/src/app/(dashboard)/expenses/page.tsx"
      provides: "Placeholder expenses page for Phase 5"
  key_links:
    - from: "apps/web/src/app/(dashboard)/page.tsx"
      to: "/dashboard/* API endpoints"
      via: "Promise.all with 5 parallel api.get calls"
      pattern: "Promise\\.all.*dashboard"
    - from: "apps/web/src/components/dashboard/quick-actions.tsx"
      to: "Next.js router"
      via: "useRouter push to /clients/new, /tasks (with create param), /policies, /expenses"
      pattern: "router\\.push|Link.*href"
    - from: "apps/web/src/components/dashboard/summary-cards.tsx"
      to: "Dashboard summary API response"
      via: "Props from parent page"
      pattern: "overdueCount|dueTodayCount|renewalsIn30Days|activeClients"
---

<objective>
Replace the placeholder dashboard page with the full Today Dashboard featuring 4 summary cards, quick action shortcuts, upcoming renewals table, overdue tasks list, recent activity feed, and premium income section.

Purpose: The dashboard is the first thing the user sees. It surfaces what needs attention (overdue tasks, upcoming renewals) and provides shortcuts to common actions. This is the "no quiet failures" visual layer.
Output: Complete dashboard page with all 6 widget sections, fetching from the 5 dashboard API endpoints built in Plan 03.
</objective>

<execution_context>
@C:\Users\abuba\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\abuba\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-tasks-renewals-and-dashboard/03-CONTEXT.md
@.planning/phases/03-tasks-renewals-and-dashboard/03-RESEARCH.md
@.planning/phases/03-tasks-renewals-and-dashboard/03-01-SUMMARY.md
@.planning/phases/03-tasks-renewals-and-dashboard/03-03-SUMMARY.md
@apps/web/src/app/(dashboard)/page.tsx
@apps/web/src/lib/api.ts
@apps/web/src/components/ui/card.tsx
@apps/web/src/components/ui/skeleton.tsx
@packages/shared/src/types/task.ts
@packages/shared/src/constants/tasks.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dashboard page layout, summary cards, and quick actions</name>
  <files>
    apps/web/src/app/(dashboard)/page.tsx
    apps/web/src/components/dashboard/summary-cards.tsx
    apps/web/src/components/dashboard/quick-actions.tsx
    apps/web/src/app/(dashboard)/expenses/page.tsx
  </files>
  <action>
**Dashboard Page (`page.tsx`) -- replace existing placeholder:**

"use client" component (needs auth context from useUser, API calls, interactive elements).

On mount, fetch all 5 dashboard data sources in parallel using `Promise.all`:
```typescript
const [summary, renewals, overdueTasks, recentActivity, premiumIncome] =
  await Promise.all([
    api.get<DashboardSummary>('/dashboard/summary'),
    api.get<UpcomingRenewal[]>('/dashboard/renewals'),
    api.get<OverdueTask[]>('/dashboard/overdue-tasks'),
    api.get<ActivityItem[]>('/dashboard/recent-activity'),
    api.get<PremiumIncome>('/dashboard/premium-income'),
  ]);
```

Define local interfaces for API response types (these are dashboard-specific, not shared):
```typescript
interface DashboardSummary {
  overdueCount: number;
  dueTodayCount: number;
  renewalsIn30Days: number;
  activeClients: number;
}
interface UpcomingRenewal {
  id: string;
  type: string;
  carrier: string | null;
  endDate: string;
  daysRemaining: number;
  client: { id: string; firstName: string; lastName: string };
}
interface OverdueTask {
  id: string;
  title: string;
  priority: string;
  dueDate: string;
  type: string;
  client: { id: string; firstName: string; lastName: string } | null;
}
interface ActivityItem {
  id: string;
  type: string;
  description: string;
  createdAt: string;
  client: { id: string; firstName: string; lastName: string };
  user: { id: string; firstName: string; lastName: string };
}
interface PremiumIncome {
  currentMonth: number;
  ytd: number;
  previousMonth: number;
  trendPercentage: number;
}
```

Layout (per user decision):
1. Header: "Today's Dashboard" with current date
2. **Summary Cards** row -- 4 cards in a responsive grid (2 cols on sm, 4 cols on lg)
3. **Quick Actions** bar -- 4 buttons
4. **Detail Sections** -- 3-column grid on lg, stacked on mobile:
   - Left: Upcoming Renewals widget
   - Center: Overdue Tasks widget
   - Right: Recent Activity feed
5. **Premium Income** section below

Show Skeleton loading states while data fetches (use Skeleton components from shadcn). Show meaningful empty states when no data (e.g., "No overdue tasks -- you're all caught up!").

**Summary Cards (`summary-cards.tsx`):**

"use client" component. Props: `summary: DashboardSummary | null`, `loading: boolean`.

4 cards using shadcn Card component:
1. **Overdue Tasks**: `overdueCount`. Icon: AlertTriangle (red). Card border/text red if count > 0 (visual urgency per user decision).
2. **Due Today**: `dueTodayCount`. Icon: Clock.
3. **Renewals (30 Days)**: `renewalsIn30Days`. Icon: CalendarClock.
4. **Active Clients**: `activeClients`. Icon: Users.

Each card: icon + label on top, large count number below.

When loading, show Skeleton in place of count.

Claude's discretion on responsive layout: `grid grid-cols-2 lg:grid-cols-4 gap-4`.

**Quick Actions (`quick-actions.tsx`):**

"use client" component. 4 action buttons in a row.

Buttons (per user decision):
1. **Add Client**: icon UserPlus, navigates to `/clients?action=create` or opens client form
2. **Add Task**: icon ListPlus, opens task creation (could navigate to `/tasks?action=create`)
3. **Add Policy**: icon ShieldPlus, navigates to `/policies?action=create` or similar
4. **Add Expense**: icon Receipt, navigates to `/expenses`. This page doesn't exist yet (Phase 5) -- create a simple placeholder page at `apps/web/src/app/(dashboard)/expenses/page.tsx` with "Coming in Phase 5" message.

Use `useRouter` from `next/navigation` for navigation. Style as secondary/outline buttons with icons. Responsive: 2 cols on small screens, 4 cols on medium+.

Also create the expense placeholder page: `apps/web/src/app/(dashboard)/expenses/page.tsx` -- simple page with "Expense tracking coming soon" message, using the same Card styling.
  </action>
  <verify>
Run `pnpm --filter web build` -- compiles cleanly.
Navigate to `/` in browser:
- Summary cards render with counts (or skeletons while loading)
- Overdue card turns red when count > 0
- Quick action buttons render and navigate correctly
- Add Expense navigates to /expenses placeholder page
  </verify>
  <done>Dashboard page replaces placeholder with real data. Summary cards show overdue tasks (red when >0), due today, renewals in 30 days, and active clients. Quick actions provide shortcuts to add client, task, policy, and expense (expense routes to placeholder). Expenses placeholder page exists at /expenses.</done>
</task>

<task type="auto">
  <name>Task 2: Renewals widget, overdue tasks widget, activity feed, and premium income</name>
  <files>
    apps/web/src/components/dashboard/renewals-widget.tsx
    apps/web/src/components/dashboard/overdue-widget.tsx
    apps/web/src/components/dashboard/activity-feed.tsx
    apps/web/src/components/dashboard/premium-income.tsx
  </files>
  <action>
**Renewals Widget (`renewals-widget.tsx`):**

"use client" component. Props: `renewals: UpcomingRenewal[] | null`, `loading: boolean`.

Card with title "Upcoming Renewals" and a simple table inside:
- Columns: Policy Type, Client, Expiry Date, Days Remaining
- Policy Type: capitalize (e.g., "Auto", "Home")
- Client: `${firstName} ${lastName}`, clickable link to `/clients/${clientId}`
- Expiry Date: formatted with date-fns `format(parseISO(endDate), 'MMM d, yyyy')`
- Days Remaining: number with color coding (red if <= 7, amber if <= 30, green otherwise)

Show "No upcoming renewals" empty state. Show skeleton rows while loading.

If more than 5 renewals, show first 5 with a "View all" link to `/policies?status=pending_renewal` or similar.

**Overdue Tasks Widget (`overdue-widget.tsx`):**

"use client" component. Props: `tasks: OverdueTask[] | null`, `loading: boolean`.

Card with title "Overdue Tasks" (with count badge in header).

List of overdue tasks, each showing:
- Title (bold)
- Client name (subtle text, or "No client" if null)
- Due date (in red, relative: "3 days overdue")
- Priority badge (color-coded: red=urgent, orange=high, yellow=medium, gray=low)
- Renewal indicator if type === 'renewal'

Click on a task could navigate to `/tasks` with that task highlighted or open edit dialog.

Show "No overdue tasks -- you're all caught up!" empty state with a checkmark icon. Show skeleton while loading.

**Activity Feed (`activity-feed.tsx`):**

"use client" component. Props: `activities: ActivityItem[] | null`, `loading: boolean`.

Card with title "Recent Activity".

List of activity items showing:
- Icon based on event type (UserPlus for client_created, Shield for policy_created, CheckSquare for task_completed, etc.)
- Description text (from API)
- Client name (clickable link)
- User name (who performed it)
- Relative timestamp (e.g., "2 hours ago", "Yesterday") using date-fns `formatDistanceToNow`

Claude's discretion: show 10 most recent events. Compact list design (small font, tight spacing).

Show "No recent activity" empty state. Show skeleton while loading.

**Premium Income (`premium-income.tsx`):**

"use client" component. Props: `income: PremiumIncome | null`, `loading: boolean`.

Card with title "Premium Income".

Three data points:
1. **Current Month**: formatted as CAD currency (e.g., "$12,450.00"). Label: "This Month"
2. **Year to Date**: formatted as CAD. Label: "YTD"
3. **Trend**: percentage change with arrow icon (TrendingUp green if positive, TrendingDown red if negative, Minus gray if zero). Text: "+12.5% vs last month" or "-3.2% vs last month"

Claude's discretion on layout: trend uses simple % change (not sparkline) per research recommendation.

Format currency with `Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD' })`.

Show skeleton while loading. Show "$0.00" for all values when no data.
  </action>
  <verify>
Run `pnpm --filter web build` -- compiles cleanly.
Navigate to `/` in browser:
- Renewals widget shows upcoming policies with days remaining and color coding
- Overdue widget shows overdue tasks with priority badges
- Activity feed shows recent events with relative timestamps
- Premium income shows current month, YTD, and trend arrow
- Empty states display correctly when no data
- Loading skeletons appear during fetch
  </verify>
  <done>All 4 dashboard detail widgets render correctly: upcoming renewals with days-remaining color coding, overdue tasks with priority badges and relative due dates, recent activity feed with icons and timestamps, premium income with CAD formatting and trend percentage indicator.</done>
</task>

</tasks>

<verification>
1. `pnpm --filter web build` compiles cleanly
2. Dashboard page loads at `/` (replaces skeleton placeholder)
3. 4 summary cards show correct counts, overdue card red when > 0
4. Quick actions: Add Client, Add Task, Add Policy navigate correctly; Add Expense goes to placeholder
5. Upcoming renewals table shows policies with days remaining
6. Overdue tasks list shows tasks with priority and overdue duration
7. Activity feed shows 10 recent events with relative timestamps
8. Premium income shows current month, YTD, trend percentage with directional indicator
9. Loading states (skeletons) display during data fetch
10. Empty states display when no data available
11. /expenses placeholder page renders correctly
</verification>

<success_criteria>
- Dashboard replaces Phase 1 placeholder skeleton cards
- DASH-01: Upcoming renewals in 30/60 days visible
- DASH-02: Overdue tasks with count and list visible
- DASH-04: Quick action shortcuts for add client, task, policy, expense
- Premium income section shows current month + YTD + trend vs previous month
- Recent activity feed shows latest events across all types
- Responsive layout: stacks on mobile, grid on desktop
- /expenses placeholder page exists for Phase 5
</success_criteria>

<output>
After completion, create `.planning/phases/03-tasks-renewals-and-dashboard/03-05-SUMMARY.md`
</output>
